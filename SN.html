<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SN1与SN2反应机制演示</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            max-width: 1200px;
            margin: 0 auto;
        }
        .reaction-container {
            width: 48%;
            min-width: 500px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 15px;
            margin-bottom: 20px;
        }
        h2 {
            text-align: center;
            color: #333;
            margin-top: 0;
        }
        .animation-area {
            height: 300px;
            position: relative;
            margin: 20px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            overflow: hidden;
        }
        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        button {
            padding: 8px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background-color: #45a049;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .explanation {
            background-color: #f9f9f9;
            padding: 10px;
            border-radius: 5px;
            border-left: 4px solid #4CAF50;
            font-size: 14px;
            line-height: 1.5;
        }
        svg {
            width: 100%;
            height: 100%;
        }
        .nucleophile {
            fill: #1E88E5;
            stroke: #0D47A1;
        }
        .leaving-group {
            fill: #E53935;
            stroke: #B71C1C;
        }
        .carbon {
            fill: #333;
            stroke: #000;
        }
        .hydrogen {
            fill: #999;
            stroke: #666;
        }
        .transition-state {
            stroke-dasharray: 5,5;
            stroke: #FF9800;
            fill: none;
            stroke-width: 2;
        }
        .electron-movement {
            stroke: #9C27B0;
            stroke-width: 1.5;
            fill: none;
            stroke-dasharray: 3,3;
            marker-end: url(#arrowhead);
        }
        .carbonation {
            fill: #FF9800;
            stroke: #E65100;
        }
        .plane {
            fill: rgba(255, 152, 0, 0.2);
            stroke: #FF9800;
            stroke-width: 1;
        }
        .label {
            font-size: 12px;
            font-weight: bold;
            fill: #555;
        }
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 10px;
            font-size: 12px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <h1>亲核取代反应机制演示</h1>
    
    <div class="legend">
        <div class="legend-item">
            <div class="legend-color" style="background-color: #1E88E5;"></div>
            <span>亲核试剂 (Nu)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #E53935;"></div>
            <span>离去基团 (L)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #333;"></div>
            <span>碳骨架</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #FF9800;"></div>
            <span>碳正离子/过渡态</span>
        </div>
    </div>
    
    <div class="container">
        <div class="reaction-container">
            <h2>SN2 反应机制</h2>
            <div class="animation-area" id="sn2-animation">
                <svg id="sn2-svg" viewBox="0 0 500 300" preserveAspectRatio="xMidYMid meet">
                    <defs>
                        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#9C27B0"/>
                        </marker>
                    </defs>
                    <!-- Initial state -->
                    <g id="sn2-initial">
                        <circle cx="150" cy="150" r="20" class="carbon"/>
                        <text x="150" y="150" text-anchor="middle" fill="white" font-size="12" dy=".3em">C</text>
                        
                        <!-- Leaving group -->
                        <circle cx="180" cy="150" r="15" class="leaving-group"/>
                        <text x="180" y="150" text-anchor="middle" fill="white" font-size="10" dy=".3em">L</text>
                        <line x1="170" y1="150" x2="165" y2="150" stroke="#B71C1C" stroke-width="2"/>
                        
                        <!-- R groups -->
                        <circle cx="150" cy="120" r="10" class="hydrogen"/>
                        <text x="150" y="120" text-anchor="middle" fill="white" font-size="8" dy=".3em">H</text>
                        <line x1="150" y1="130" x2="150" y2="140" stroke="#666" stroke-width="2"/>
                        
                        <circle cx="120" cy="150" r="10" class="hydrogen"/>
                        <text x="120" y="150" text-anchor="middle" fill="white" font-size="8" dy=".3em">H</text>
                        <line x1="130" y1="150" x2="140" y2="150" stroke="#666" stroke-width="2"/>
                        
                        <circle cx="150" cy="180" r="10" class="hydrogen"/>
                        <text x="150" y="180" text-anchor="middle" fill="white" font-size="8" dy=".3em">H</text>
                        <line x1="150" y1="170" x2="150" y2="160" stroke="#666" stroke-width="2"/>
                        
                        <!-- Nucleophile -->
                        <circle cx="50" cy="150" r="15" class="nucleophile"/>
                        <text x="50" y="150" text-anchor="middle" fill="white" font-size="10" dy=".3em">Nu</text>
                        
                        <!-- Electron movement -->
                        <path id="sn2-electron-path" class="electron-movement" d="M70,150 L130,150"/>
                    </g>
                    
                    <!-- Transition state -->
                    <g id="sn2-transition" opacity="0">
                        <circle cx="150" cy="150" r="25" class="transition-state"/>
                        
                        <circle cx="150" cy="150" r="20" class="carbon"/>
                        <text x="150" y="150" text-anchor="middle" fill="white" font-size="12" dy=".3em">C</text>
                        
                        <!-- Partial leaving group -->
                        <circle cx="170" cy="150" r="15" class="leaving-group" opacity="0.7"/>
                        <text x="170" y="150" text-anchor="middle" fill="white" font-size="10" dy=".3em">L</text>
                        <line x1="160" y1="150" x2="165" y2="150" stroke="#B71C1C" stroke-width="2" stroke-dasharray="3,3"/>
                        
                        <!-- Partial nucleophile -->
                        <circle cx="130" cy="150" r="15" class="nucleophile" opacity="0.7"/>
                        <text x="130" y="150" text-anchor="middle" fill="white" font-size="10" dy=".3em">Nu</text>
                        <line x1="140" y1="150" x2="135" y2="150" stroke="#0D47A1" stroke-width="2" stroke-dasharray="3,3"/>
                        
                        <!-- R groups (inverted) -->
                        <circle cx="150" cy="120" r="10" class="hydrogen"/>
                        <text x="150" y="120" text-anchor="middle" fill="white" font-size="8" dy=".3em">H</text>
                        <line x1="150" y1="130" x2="150" y2="140" stroke="#666" stroke-width="2"/>
                        
                        <circle cx="180" cy="150" r="10" class="hydrogen"/>
                        <text x="180" y="150" text-anchor="middle" fill="white" font-size="8" dy=".3em">H</text>
                        <line x1="170" y1="150" x2="160" y2="150" stroke="#666" stroke-width="2"/>
                        
                        <circle cx="150" cy="180" r="10" class="hydrogen"/>
                        <text x="150" y="180" text-anchor="middle" fill="white" font-size="8" dy=".3em">H</text>
                        <line x1="150" y1="170" x2="150" y2="160" stroke="#666" stroke-width="2"/>
                        
                        <text x="150" y="100" text-anchor="middle" class="label">五配位过渡态</text>
                    </g>
                    
                    <!-- Final state -->
                    <g id="sn2-final" opacity="0">
                        <circle cx="150" cy="150" r="20" class="carbon"/>
                        <text x="150" y="150" text-anchor="middle" fill="white" font-size="12" dy=".3em">C</text>
                        
                        <!-- Nucleophile attached -->
                        <circle cx="120" cy="150" r="15" class="nucleophile"/>
                        <text x="120" y="150" text-anchor="middle" fill="white" font-size="10" dy=".3em">Nu</text>
                        <line x1="130" y1="150" x2="140" y2="150" stroke="#0D47A1" stroke-width="2"/>
                        
                        <!-- R groups (inverted) -->
                        <circle cx="150" cy="120" r="10" class="hydrogen"/>
                        <text x="150" y="120" text-anchor="middle" fill="white" font-size="8" dy=".3em">H</text>
                        <line x1="150" y1="130" x2="150" y2="140" stroke="#666" stroke-width="2"/>
                        
                        <circle cx="180" cy="150" r="10" class="hydrogen"/>
                        <text x="180" y="150" text-anchor="middle" fill="white" font-size="8" dy=".3em">H</text>
                        <line x1="170" y1="150" x2="160" y2="150" stroke="#666" stroke-width="2"/>
                        
                        <circle cx="150" cy="180" r="10" class="hydrogen"/>
                        <text x="150" y="180" text-anchor="middle" fill="white" font-size="8" dy=".3em">H</text>
                        <line x1="150" y1="170" x2="150" y2="160" stroke="#666" stroke-width="2"/>
                        
                        <!-- Leaving group detached -->
                        <circle cx="250" cy="150" r="15" class="leaving-group"/>
                        <text x="250" y="150" text-anchor="middle" fill="white" font-size="10" dy=".3em">L</text>
                        
                        <!-- Electron movement -->
                        <path id="sn2-electron-path-final" class="electron-movement" d="M135,150 L240,150"/>
                    </g>
                </svg>
            </div>
            <div class="controls">
                <button id="sn2-start">开始</button>
                <button id="sn2-pause">暂停</button>
                <button id="sn2-reset">重置</button>
            </div>
            <div class="explanation" id="sn2-explanation">
                SN2反应(双分子亲核取代)特点:
                <ul>
                    <li>单步骤协同机制</li>
                    <li>亲核试剂从背面进攻碳中心</li>
                    <li>形成五配位过渡态</li>
                    <li>立体化学发生Walden翻转</li>
                    <li>反应速率受两者浓度影响</li>
                </ul>
            </div>
        </div>
        
        <div class="reaction-container">
            <h2>SN1 反应机制</h2>
            <div class="animation-area" id="sn1-animation">
                <svg id="sn1-svg" viewBox="0 0 500 300" preserveAspectRatio="xMidYMid meet">
                    <defs>
                        <marker id="arrowhead-sn1" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#9C27B0"/>
                        </marker>
                    </defs>
                    
                    <!-- Initial state -->
                    <g id="sn1-initial">
                        <circle cx="150" cy="150" r="20" class="carbon"/>
                        <text x="150" y="150" text-anchor="middle" fill="white" font-size="12" dy=".3em">C</text>
                        
                        <!-- Leaving group -->
                        <circle cx="180" cy="150" r="15" class="leaving-group"/>
                        <text x="180" y="150" text-anchor="middle" fill="white" font-size="10" dy=".3em">L</text>
                        <line x1="170" y1="150" x2="165" y2="150" stroke="#B71C1C" stroke-width="2"/>
                        
                        <!-- R groups (3 groups for tertiary carbon) -->
                        <circle cx="150" cy="120" r="10" class="hydrogen"/>
                        <text x="150" y="120" text-anchor="middle" fill="white" font-size="8" dy=".3em">R</text>
                        <line x1="150" y1="130" x2="150" y2="140" stroke="#666" stroke-width="2"/>
                        
                        <circle cx="120" cy="150" r="10" class="hydrogen"/>
                        <text x="120" y="150" text-anchor="middle" fill="white" font-size="8" dy=".3em">R</text>
                        <line x1="130" y1="150" x2="140" y2="150" stroke="#666" stroke-width="2"/>
                        
                        <circle cx="150" cy="180" r="10" class="hydrogen"/>
                        <text x="150" y="180" text-anchor="middle" fill="white" font-size="8" dy=".3em">R</text>
                        <line x1="150" y1="170" x2="150" y2="160" stroke="#666" stroke-width="2"/>
                        
                        <!-- Nucleophiles (both sides) -->
                        <circle cx="50" cy="120" r="15" class="nucleophile"/>
                        <text x="50" y="120" text-anchor="middle" fill="white" font-size="10" dy=".3em">Nu</text>
                        
                        <circle cx="50" cy="180" r="15" class="nucleophile"/>
                        <text x="50" y="180" text-anchor="middle" fill="white" font-size="10" dy=".3em">Nu</text>
                        
                        <!-- Electron movement -->
                        <path id="sn1-electron-path1" class="electron-movement" d="M165,150 L240,150"/>
                    </g>
                    
                    <!-- Carbocation intermediate -->
                    <g id="sn1-intermediate" opacity="0">
                        <circle cx="150" cy="150" r="20" class="carbonation"/>
                        <text x="150" y="150" text-anchor="middle" fill="white" font-size="12" dy=".3em">C+</text>
                        
                        <!-- Plane of sp2 hybridization -->
                        <ellipse cx="150" cy="150" rx="30" ry="15" class="plane" transform="rotate(45 150 150)"/>
                        
                        <!-- R groups -->
                        <circle cx="150" cy="120" r="10" class="hydrogen"/>
                        <text x="150" y="120" text-anchor="middle" fill="white" font-size="8" dy=".3em">R</text>
                        <line x1="150" y1="130" x2="150" y2="140" stroke="#666" stroke-width="2"/>
                        
                        <circle cx="120" cy="150" r="10" class="hydrogen"/>
                        <text x="120" y="150" text-anchor="middle" fill="white" font-size="8" dy=".3em">R</text>
                        <line x1="130" y1="150" x2="140" y2="150" stroke="#666" stroke-width="2"/>
                        
                        <circle cx="150" cy="180" r="10" class="hydrogen"/>
                        <text x="150" y="180" text-anchor="middle" fill="white" font-size="8" dy=".3em">R</text>
                        <line x1="150" y1="170" x2="150" y2="160" stroke="#666" stroke-width="2"/>
                        
                        <!-- Leaving group detached -->
                        <circle cx="250" cy="150" r="15" class="leaving-group"/>
                        <text x="250" y="150" text-anchor="middle" fill="white" font-size="10" dy=".3em">L</text>
                        
                        <text x="150" y="100" text-anchor="middle" class="label">平面sp²碳正离子中间体</text>
                    </g>
                    
                    <!-- Final states (racemic mixture) -->
                    <g id="sn1-final-left" opacity="0">
                        <circle cx="100" cy="150" r="20" class="carbon"/>
                        <text x="100" y="150" text-anchor="middle" fill="white" font-size="12" dy=".3em">C</text>
                        
                        <!-- Nucleophile attached (left side) -->
                        <circle cx="70" cy="150" r="15" class="nucleophile"/>
                        <text x="70" y="150" text-anchor="middle" fill="white" font-size="10" dy=".3em">Nu</text>
                        <line x1="80" y1="150" x2="90" y2="150" stroke="#0D47A1" stroke-width="2"/>
                        
                        <!-- R groups (inverted) -->
                        <circle cx="100" cy="120" r="10" class="hydrogen"/>
                        <text x="100" y="120" text-anchor="middle" fill="white" font-size="8" dy=".3em">R</text>
                        <line x1="100" y1="130" x2="100" y2="140" stroke="#666" stroke-width="2"/>
                        
                        <circle cx="130" cy="150" r="10" class="hydrogen"/>
                        <text x="130" y="150" text-anchor="middle" fill="white" font-size="8" dy=".3em">R</text>
                        <line x1="120" y1="150" x2="110" y2="150" stroke="#666" stroke-width="2"/>
                        
                        <circle cx="100" cy="180" r="10" class="hydrogen"/>
                        <text x="100" y="180" text-anchor="middle" fill="white" font-size="8" dy=".3em">R</text>
                        <line x1="100" y1="170" x2="100" y2="160" stroke="#666" stroke-width="2"/>
                        
                        <text x="100" y="210" text-anchor="middle" class="label">(S)-构型</text>
                    </g>
                    
                    <g id="sn1-final-right" opacity="0">
                        <circle cx="300" cy="150" r="20" class="carbon"/>
                        <text x="300" y="150" text-anchor="middle" fill="white" font-size="12" dy=".3em">C</text>
                        
                        <!-- Nucleophile attached (right side) -->
                        <circle cx="330" cy="150" r="15" class="nucleophile"/>
                        <text x="330" y="150" text-anchor="middle" fill="white" font-size="10" dy=".3em">Nu</text>
                        <line x1="320" y1="150" x2="310" y2="150" stroke="#0D47A1" stroke-width="2"/>
                        
                        <!-- R groups -->
                        <circle cx="300" cy="120" r="10" class="hydrogen"/>
                        <text x="300" y="120" text-anchor="middle" fill="white" font-size="8" dy=".3em">R</text>
                        <line x1="300" y1="130" x2="300" y2="140" stroke="#666" stroke-width="2"/>
                        
                        <circle cx="270" cy="150" r="10" class="hydrogen"/>
                        <text x="270" y="150" text-anchor="middle" fill="white" font-size="8" dy=".3em">R</text>
                        <line x1="280" y1="150" x2="290" y2="150" stroke="#666" stroke-width="2"/>
                        
                        <circle cx="300" cy="180" r="10" class="hydrogen"/>
                        <text x="300" y="180" text-anchor="middle" fill="white" font-size="8" dy=".3em">R</text>
                        <line x1="300" y1="170" x2="300" y2="160" stroke="#666" stroke-width="2"/>
                        
                        <text x="300" y="210" text-anchor="middle" class="label">(R)-构型</text>
                    </g>
                    
                    <!-- Electron movements for attack -->
                    <path id="sn1-electron-path-left" class="electron-movement" d="M70,120 L130,140" opacity="0"/>
                    <path id="sn1-electron-path-right" class="electron-movement" d="M70,180 L130,160" opacity="0"/>
                </svg>
            </div>
            <div class="controls">
                <button id="sn1-start">开始</button>
                <button id="sn1-pause">暂停</button>
                <button id="sn1-reset">重置</button>
            </div>
            <div class="explanation" id="sn1-explanation">
                SN1反应(单分子亲核取代)特点:
                <ul>
                    <li>两步反应机制</li>
                    <li>第一步: 离去基团解离形成碳正离子</li>
                    <li>第二步: 亲核试剂随机进攻平面sp²碳</li>
                    <li>形成外消旋混合物</li>
                    <li>反应速率只与底物浓度有关</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // SN2 Animation
        const sn2StartBtn = document.getElementById('sn2-start');
        const sn2PauseBtn = document.getElementById('sn2-pause');
        const sn2ResetBtn = document.getElementById('sn2-reset');
        
        const sn2Initial = document.getElementById('sn2-initial');
        const sn2Transition = document.getElementById('sn2-transition');
        const sn2Final = document.getElementById('sn2-final');
        const sn2Explanation = document.getElementById('sn2-explanation');
        
        let sn2Animation;
        let sn2Step = 0;
        
        function resetSN2() {
            sn2Initial.setAttribute('opacity', '1');
            sn2Transition.setAttribute('opacity', '0');
            sn2Final.setAttribute('opacity', '0');
            sn2Step = 0;
            sn2Explanation.innerHTML = `
                SN2反应(双分子亲核取代)特点:
                <ul>
                    <li>单步骤协同机制</li>
                    <li>亲核试剂从背面进攻碳中心</li>
                    <li>形成五配位过渡态</li>
                    <li>立体化学发生Walden翻转</li>
                    <li>反应速率受两者浓度影响</li>
                </ul>
            `;
        }
        
        function animateSN2() {
            sn2StartBtn.disabled = true;
            sn2PauseBtn.disabled = false;
            
            if (sn2Step === 0) {
                // Move nucleophile towards carbon
                const nucleophile = sn2Initial.querySelector('circle.nucleophile');
                const electronPath = document.getElementById('sn2-electron-path');
                
                let pos = 50;
                const id = setInterval(frame, 20);
                function frame() {
                    if (pos >= 90) {
                        clearInterval(id);
                        sn2Step = 1;
                        animateSN2();
                    } else {
                        pos += 2;
                        nucleophile.setAttribute('cx', pos);
                        electronPath.setAttribute('d', `M${pos+20},150 L130,150`);
                    }
                }
                
                sn2Explanation.innerHTML = `
                    亲核试剂(Nu, 蓝色)从背面接近碳中心，开始形成新键...
                    <div style="margin-top:10px;color:#1E88E5">电子对从亲核试剂向碳原子转移</div>
                `;
            } else if (sn2Step === 1) {
                // Show transition state
                sn2Initial.setAttribute('opacity', '0');
                sn2Transition.setAttribute('opacity', '1');
                
                setTimeout(() => {
                    sn2Step = 2;
                    animateSN2();
                }, 1500);
                
                sn2Explanation.innerHTML = `
                    五配位过渡态形成:
                    <ul>
                        <li>碳中心暂时与5个基团相连(虚线圆圈)</li>
                        <li>C-Nu键部分形成</li>
                        <li>C-L键部分断裂</li>
                        <li>三个取代基开始翻转</li>
                    </ul>
                `;
            } else if (sn2Step === 2) {
                // Show final state
                sn2Transition.setAttribute('opacity', '0');
                sn2Final.setAttribute('opacity', '1');
                
                // Animate leaving group departure
                const leavingGroup = sn2Final.querySelector('circle.leaving-group');
                const electronPath = document.getElementById('sn2-electron-path-final');
                
                let pos = 250;
                const id = setInterval(frame, 20);
                function frame() {
                    if (pos >= 350) {
                        clearInterval(id);
                        sn2Step = 3;
                        sn2Animation = null;
                        sn2StartBtn.disabled = false;
                        sn2PauseBtn.disabled = true;
                    } else {
                        pos += 2;
                        leavingGroup.setAttribute('cx', pos);
                        electronPath.setAttribute('d', `M135,150 L${pos-10},150`);
                    }
                }
                
                sn2Explanation.innerHTML = `
                    Walden翻转完成:
                    <ul>
                        <li>离去基团(L, 红色)带着电子对离开</li>
                        <li>亲核试剂(Nu)与碳中心完全成键</li>
                        <li>三个取代基的空间构型完全翻转</li>
                        <li>产物构型与反应物相反</li>
                    </ul>
                `;
            }
        }
        
        sn2StartBtn.addEventListener('click', () => {
            if (!sn2Animation) {
                if (sn2Step === 3) resetSN2();
                sn2Animation = true;
                animateSN2();
            }
        });
        
        sn2PauseBtn.addEventListener('click', () => {
            // Simple implementation - just reset
            resetSN2();
            sn2Animation = null;
            sn2StartBtn.disabled = false;
            sn2PauseBtn.disabled = true;
        });
        
        sn2ResetBtn.addEventListener('click', resetSN2);
        
        // SN1 Animation
        const sn1StartBtn = document.getElementById('sn1-start');
        const sn1PauseBtn = document.getElementById('sn1-pause');
        const sn1ResetBtn = document.getElementById('sn1-reset');
        
        const sn1Initial = document.getElementById('sn1-initial');
        const sn1Intermediate = document.getElementById('sn1-intermediate');
        const sn1FinalLeft = document.getElementById('sn1-final-left');
        const sn1FinalRight = document.getElementById('sn1-final-right');
        const sn1Explanation = document.getElementById('sn1-explanation');
        
        let sn1Animation;
        let sn1Step = 0;
        
        function resetSN1() {
            sn1Initial.setAttribute('opacity', '1');
            sn1Intermediate.setAttribute('opacity', '0');
            sn1FinalLeft.setAttribute('opacity', '0');
            sn1FinalRight.setAttribute('opacity', '0');
            
            document.getElementById('sn1-electron-path-left').setAttribute('opacity', '0');
            document.getElementById('sn1-electron-path-right').setAttribute('opacity', '0');
            
            sn1Step = 0;
            sn1Explanation.innerHTML = `
                SN1反应(单分子亲核取代)特点:
                <ul>
                    <li>两步反应机制</li>
                    <li>第一步: 离去基团解离形成碳正离子</li>
                    <li>第二步: 亲核试剂随机进攻平面sp²碳</li>
                    <li>形成外消旋混合物</li>
                    <li>反应速率只与底物浓度有关</li>
                </ul>
            `;
        }
        
        function animateSN1() {
            sn1StartBtn.disabled = true;
            sn1PauseBtn.disabled = false;
            
            if (sn1Step === 0) {
                // Leaving group departure
                const leavingGroup = sn1Initial.querySelector('circle.leaving-group');
                const electronPath = document.getElementById('sn1-electron-path1');
                
                let pos = 180;
                const id = setInterval(frame, 20);
                function frame() {
                    if (pos >= 250) {
                        clearInterval(id);
                        sn1Step = 1;
                        animateSN1();
                    } else {
                        pos += 2;
                        leavingGroup.setAttribute('cx', pos);
                        electronPath.setAttribute('d', `M165,150 L${pos-10},150`);
                    }
                }
                
                sn1Explanation.innerHTML = `
                    第一步: 离去基团(L, 红色)解离
                    <ul>
                        <li>C-L键断裂</li>
                        <li>离去基团带着电子对离开</li>
                        <li>形成平面sp²杂化的碳正离子中间体</li>
                        <li>这一步是速率决定步骤</li>
                    </ul>
                `;
            } else if (sn1Step === 1) {
                // Show carbocation intermediate
                sn1Initial.setAttribute('opacity', '0');
                sn1Intermediate.setAttribute('opacity', '1');
                
                setTimeout(() => {
                    sn1Step = 2;
                    animateSN1();
                }, 1500);
                
                sn1Explanation.innerHTML = `
                    碳正离子中间体形成:
                    <ul>
                        <li>碳中心为sp²杂化，平面结构</li>
                        <li>带正电荷(橙色)</li>
                        <li>亲核试剂可以从平面两侧随机进攻</li>
                        <li>中间体稳定性决定反应速率</li>
                    </ul>
                `;
            } else if (sn1Step === 2) {
                // Show nucleophilic attack from both sides
                const leftPath = document.getElementById('sn1-electron-path-left');
                const rightPath = document.getElementById('sn1-electron-path-right');
                
                leftPath.setAttribute('opacity', '1');
                rightPath.setAttribute('opacity', '1');
                
                setTimeout(() => {
                    sn1Intermediate.setAttribute('opacity', '0');
                    sn1FinalLeft.setAttribute('opacity', '1');
                    sn1FinalRight.setAttribute('opacity', '1');
                    
                    sn1Step = 3;
                    sn1Animation = null;
                    sn1StartBtn.disabled = false;
                    sn1PauseBtn.disabled = true;
                }, 1500);
                
                sn1Explanation.innerHTML = `
                    第二步: 亲核试剂进攻
                    <ul>
                        <li>亲核试剂从平面两侧随机进攻</li>
                        <li>50%概率从左侧进攻(形成S构型)</li>
                        <li>50%概率从右侧进攻(形成R构型)</li>
                        <li>最终产物为外消旋混合物</li>
                    </ul>
                `;
            }
        }
        
        sn1StartBtn.addEventListener('click', () => {
            if (!sn1Animation) {
                if (sn1Step === 3) resetSN1();
                sn1Animation = true;
                animateSN1();
            }
        });
        
        sn1PauseBtn.addEventListener('click', () => {
            // Simple implementation - just reset
            resetSN1();
            sn1Animation = null;
            sn1StartBtn.disabled = false;
            sn1PauseBtn.disabled = true;
        });
        
        sn1ResetBtn.addEventListener('click', resetSN1);
        
        // Initialize
        resetSN2();
        resetSN1();
    </script>
</body>
</html>